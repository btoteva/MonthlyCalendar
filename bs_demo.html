<!doctype html>
<html lang="en">
 <head>
  <meta charset="utf-8">
  <title>jQuery Monthly Calendar</title>
  <meta name="description" content="An Icon Font Generated By IcoMoon.io">
  <meta name="viewport" content="width=device-width">
  
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <link rel="stylesheet" href="css/font-awesome.min.css">
  <link rel="stylesheet" href="css/monthly-calendar.css">
  
 </head>
 <body>
	<h2><strong><a href="./" class="btn btn-default btn-xs"> Home </a></strong></h2>
	<div class="container ">
		<div class="status">loading...</div>
		<div class="calendar_holder col-sm-12 jumbotron"><i class="loading">prepare loading...</i></div>
	</div>
  <script src="js/jquery-1.11.1.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/moment-with-locales.js"></script>
  <script src="js/monthly-calendar.js"></script>
  <script type="text/javascript">
	
        $(function(){
			var calendar;

			$(document).ready(function() {
				
				calendar = $('.calendar_holder').monthlyCalendar({
					//'defaultDate':moment().year(moment().get('year')).month(0).date(1).format("YYYY-MM-DD"),
					'lang':'bg',
					'startMonth': 1,
					'endMonth': 12,
					'dayClass':'btn-xs btn-default',
					'monthWrapperClass': 'col-sm-3 panel panel-default',
					'monthWrapperStyle': 'min-height:160px; border:0px; ',
					'events': [
						{
							start: '2014-01-01',
							title: 'New Year',
							eClass: ''
						},
						{
							start: '2014-03-03',
							title: 'Day of the liberation of Bulgaria from Ottoman rule',
							eClass: ''
						},
						{
							start: '2014-05-10',
							title: 'Working out 02 May',
							eClass: 'workOut'
						},
						{
							start: '2014-05-31',
							title: 'Working out 05 May',
							eClass: 'workOut'
						},
						{
							start: '2014-12-13',
							title: 'Working out 31 Dec',
							eClass: 'workOut'
						}
					],
					'init': function(date,element){
						element.hide();
					},
					'ready': function(date,element){

						day=element.find('.day');
						day.attr('data-toggle','popover');

						template=getPopoverTemplate();
						
						day.popover({
							container: 'body',
							placement:function () { 
								pop_element=$(this)[0]['$tip'];
								pop_element_id=pop_element.attr('id');
								current_element=$(this)[0]['$element'];
								current_element_title=getTitle(current_element) ;
								other_pop_element=$('.popover:not(.popover#'+pop_element_id+')');
								other_pop_element_id=other_pop_element.attr('id');
								other_pop_element.popover('hide');
								day.removeClass('active');
								current_element.addClass('active');
								pop_element.find('.popover-title')
								  .html(
								    (current_element_title.length>0)?('<strong>'+getDate(current_element)+'</strong> '+current_element_title):getDate(current_element)
								  )
								  .on('click', function(){
									current_element.popover('hide');
								  });
								  pop_element.find('.btn_close').on('click', function() {
								  	current_element.popover('hide');
								  });
								  //pop_element.find('.btn_action').on('click', function() {
								  //	alert('not coded yet');
								  //});
								  
								return 'top'
							},
							title:function () { 
								return getDate($(this));
							},
							template: template,
							content: function() {
								return setContent($(this));
							},
							html: true
						});
						
						function getDate(element) {
							dt_month=element.parents('.month_wrapper').data('month');
							dt_day=element.text();
							dt=date.month(dt_month).subtract(1,'months').date(dt_day).format('DD MMMM YYYY');
							return dt;
						}
						function setContent(element) {
							title=getTitle(element);
							result=(title && title.length>0)?(getBtn('edit')+' '+getBtn('remove')+' '+getBtn('cancel')):(getBtn('new')+' '+getBtn('cancel'));
							return result;
						}
						function getTitle(element) {
							return element.attr('data-original-title') || element.attr('title');
						}
						function getPopoverTemplate() {
							template='<div class="popover" role="tooltip " ><div class="tooltip-arrow"></div>';
							template+='<h3 class="popover-title"></h3>';
							template+='<div class="popover-content text-center"></div>';
							template+='</div>';
							return template;
						}
						function getBtn(name) {
							switch(name) {
								case 'new':
									btn='<a href="#" class="btn_action btn btn-info btn-xs"><i class="fa fa-plus-square "></i> New </a>';
									break;
								case 'edit':
									btn='<a href="#" class="btn_action btn btn-success btn-xs"><i class="fa fa-pencil-square"></i> Edit </a>';
									break;
								case 'remove':
									btn='<a href="#" class="btn_action btn btn-danger btn-xs"><i class="fa fa-trash"></i> Remove </a>';
									break;
								case 'cancel':
									btn='<a href="#" class="btn_close btn btn-default btn-xs"> Cancel </a>';
									break;
								default:
									btn='';
							}
							return btn;
						}
						
						day.tooltip({
							container: 'body',
							placement:'left'
						});	
						
						$('.calendar_holder>.loading').delay( 800 ).queue(function() {
							  $(this).remove();
							 $('.status').html('');
							  element.parent().show();
						  });
						
						
					}

				});
			});
			
        });
    </script>
	
 </body>
</html>